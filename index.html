<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¥‹ Club de Judo â€” Tableau des TÃ¢ches</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --red: #e63329;
    --dark: #1a1a2e;
    --navy: #16213e;
    --gold: #f5a623;
    --white: #f9f7f0;
    --gray: #8a8a9a;
    --green: #27ae60;
    --blue: #2980b9;
    --orange: #e67e22;
    --card-bg: #ffffff;
    --shadow: 0 4px 20px rgba(0,0,0,0.12);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--dark);
    color: var(--white);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* STATUS BAR */
  #firebase-status {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 2000;
    text-align: center;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 6px;
    transition: all 0.3s;
    letter-spacing: 0.5px;
  }
  #firebase-status.connecting { background: #e67e22; color: white; }
  #firebase-status.connected  { background: var(--green); color: white; }
  #firebase-status.error      { background: var(--red); color: white; }

  header {
    background: linear-gradient(135deg, var(--dark) 0%, #0f3460 100%);
    padding: 36px 20px 0;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  header::before {
    content: '';
    position: absolute;
    inset: 0;
    background: repeating-linear-gradient(45deg,transparent,transparent 20px,rgba(255,255,255,0.015) 20px,rgba(255,255,255,0.015) 40px);
  }
  .header-logo { font-size: 2.8rem; line-height: 1; position: relative; z-index: 1; }
  header h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(1.8rem, 6vw, 3rem);
    letter-spacing: 3px;
    color: var(--white);
    position: relative; z-index: 1;
  }
  header h1 span { color: var(--gold); }
  header p.subtitle { font-size: 0.85rem; color: var(--gray); margin: 4px 0 16px; position: relative; z-index: 1; }

  .tabs {
    display: flex;
    background: rgba(0,0,0,0.3);
    position: relative; z-index: 1;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .tabs::-webkit-scrollbar { display: none; }
  .tab {
    flex: 1; min-width: 80px;
    padding: 12px 8px;
    text-align: center;
    font-size: 0.78rem; font-weight: 700;
    color: var(--gray);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .tab.active { color: var(--gold); border-bottom-color: var(--gold); background: rgba(245,166,35,0.08); }
  .tab-icon { display: block; font-size: 1.3rem; margin-bottom: 2px; }

  main { padding: 16px; max-width: 900px; margin: 0 auto; }
  .section { display: none; }
  .section.active { display: block; }

  .stats-bar { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 16px; }
  .stat-card { background: var(--navy); border-radius: 12px; padding: 12px 8px; text-align: center; border: 1px solid rgba(255,255,255,0.08); }
  .stat-number { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; line-height: 1; color: var(--gold); }
  .stat-label { font-size: 0.65rem; color: var(--gray); margin-top: 2px; text-transform: uppercase; letter-spacing: 0.5px; }

  .filter-bar { display: flex; gap: 8px; margin-bottom: 14px; flex-wrap: wrap; align-items: center; }
  .filter-bar select, .filter-bar input {
    background: var(--navy);
    border: 1px solid rgba(255,255,255,0.15);
    color: var(--white);
    padding: 8px 12px; border-radius: 8px;
    font-family: 'Nunito', sans-serif; font-size: 0.82rem;
    flex: 1; min-width: 120px;
  }
  .filter-bar select option { background: var(--navy); }

  .btn-add {
    background: var(--red); color: white; border: none;
    padding: 10px 20px; border-radius: 10px;
    font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.9rem;
    cursor: pointer; display: flex; align-items: center; gap: 6px;
    transition: transform 0.15s, box-shadow 0.15s;
    box-shadow: 0 4px 12px rgba(230,51,41,0.4);
    white-space: nowrap;
  }
  .btn-add:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(230,51,41,0.5); }

  .kanban { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; }
  @media(max-width:600px) {
    .kanban { grid-template-columns: 1fr; }
    .stats-bar { grid-template-columns: repeat(2,1fr); }
  }

  .kanban-col { background: var(--navy); border-radius: 14px; padding: 12px; border: 1px solid rgba(255,255,255,0.07); min-height: 200px; }
  .col-header {
    font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px;
    padding: 8px 10px; border-radius: 8px; margin-bottom: 10px;
    display: flex; align-items: center; gap: 8px;
  }
  .col-todo .col-header  { background: rgba(41,128,185,0.25); color: #74b9e7; }
  .col-doing .col-header { background: rgba(230,126,34,0.25); color: #f0a65a; }
  .col-done .col-header  { background: rgba(39,174,96,0.25);  color: #6dd5a0; }
  .col-count { background: rgba(255,255,255,0.15); border-radius: 20px; font-size: 0.7rem; padding: 1px 8px; font-family: 'Nunito', sans-serif; font-weight: 700; margin-left: auto; }

  .task-card {
    background: var(--card-bg); color: #1a1a2e;
    border-radius: 10px; padding: 12px; margin-bottom: 8px;
    box-shadow: var(--shadow); cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    position: relative; overflow: hidden;
  }
  .task-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.18); }
  .task-card::before { content:''; position:absolute; left:0;top:0;bottom:0;width:4px; border-radius:10px 0 0 10px; }
  .task-card.prio-haute::before  { background: var(--red); }
  .task-card.prio-normale::before{ background: var(--blue); }
  .task-card.prio-basse::before  { background: var(--green); }
  .task-card.overdue { background: #fff8f8; }
  .task-card.overdue .task-title { color: var(--red); }

  .task-title  { font-weight: 800; font-size: 0.88rem; margin-bottom: 6px; padding-right: 28px; }
  .task-desc   { font-size: 0.75rem; color: #555; margin-bottom: 8px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .task-meta   { display: flex; flex-wrap: wrap; gap: 5px; align-items: center; }
  .tag { font-size: 0.65rem; font-weight: 700; padding: 2px 8px; border-radius: 20px; text-transform: uppercase; letter-spacing: 0.3px; }
  .tag-member   { background: #e8f4fd; color: #1a6eb5; }
  .tag-deadline { background: #fff3e0; color: #b35a00; }
  .tag-prio-haute   { background: #fde8e8; color: #c0392b; }
  .tag-prio-normale { background: #e8f0fe; color: #1a56db; }
  .tag-prio-basse   { background: #e8f8f0; color: #0d6b3a; }
  .tag-category { background: #f3e8ff; color: #6b21a8; }
  .overdue-badge { font-size: 0.6rem; background: var(--red); color: white; padding: 1px 6px; border-radius: 20px; font-weight: 700; }

  .task-actions { position: absolute; top: 10px; right: 10px; display: flex; gap: 4px; }
  .task-btn { background: none; border: none; cursor: pointer; font-size: 1rem; padding: 2px; border-radius: 4px; transition: background 0.1s; line-height: 1; }
  .task-btn:hover { background: rgba(0,0,0,0.08); }

  .status-cycle { display: flex; gap: 5px; margin-top: 8px; }
  .status-btn {
    flex: 1; border: none; padding: 5px; border-radius: 6px;
    font-size: 0.62rem; font-weight: 700; cursor: pointer;
    font-family: 'Nunito', sans-serif; transition: opacity 0.2s, transform 0.15s;
    opacity: 0.4; text-transform: uppercase; letter-spacing: 0.3px;
  }
  .status-btn.active { opacity: 1; transform: scale(1.05); }
  .status-btn.todo-btn  { background: #2980b9; color: white; }
  .status-btn.doing-btn { background: #e67e22; color: white; }
  .status-btn.done-btn  { background: #27ae60; color: white; }

  .urgency-banner {
    background: linear-gradient(135deg,rgba(230,51,41,0.2),rgba(230,51,41,0.05));
    border: 1px solid rgba(230,51,41,0.3); border-radius: 12px;
    padding: 12px 16px; margin-bottom: 12px;
    display: flex; align-items: center; gap: 10px; font-size: 0.82rem;
  }
  .urgency-banner strong { color: var(--red); }

  .empty-state { text-align: center; padding: 30px; color: var(--gray); font-size: 0.85rem; }
  .empty-state-icon { font-size: 2.5rem; margin-bottom: 8px; opacity: 0.5; }

  /* MODAL */
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 16px; backdrop-filter: blur(4px); }
  .modal-overlay.open { display: flex; }
  .modal { background: #1e2a4a; border-radius: 18px; padding: 24px; width: 100%; max-width: 480px; border: 1px solid rgba(255,255,255,0.12); box-shadow: 0 20px 60px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
  .modal h2 { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 2px; color: var(--gold); margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
  .form-group { margin-bottom: 14px; }
  .form-group label { display: block; font-size: 0.78rem; font-weight: 700; color: var(--gray); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
  .form-group input, .form-group textarea, .form-group select {
    width: 100%; background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.15); color: var(--white);
    padding: 10px 12px; border-radius: 8px;
    font-family: 'Nunito', sans-serif; font-size: 0.88rem; transition: border-color 0.2s;
  }
  .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: var(--gold); }
  .form-group select option { background: #1e2a4a; }
  .form-group textarea { resize: vertical; min-height: 80px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .modal-actions { display: flex; gap: 10px; margin-top: 18px; }
  .btn-primary { flex: 1; background: var(--red); color: white; border: none; padding: 12px; border-radius: 10px; font-family: 'Nunito', sans-serif; font-weight: 800; font-size: 0.9rem; cursor: pointer; transition: background 0.2s; }
  .btn-primary:hover { background: #c0392b; }
  .btn-secondary { flex: 1; background: rgba(255,255,255,0.1); color: var(--white); border: 1px solid rgba(255,255,255,0.2); padding: 12px; border-radius: 10px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.9rem; cursor: pointer; }
  .btn-danger { background: rgba(231,76,60,0.15); color: #e74c3c; border: 1px solid rgba(231,76,60,0.3); padding: 10px 16px; border-radius: 8px; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.85rem; cursor: pointer; }

  /* MEMBERS */
  .members-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(180px,1fr)); gap: 12px; margin-top: 12px; }
  .member-card { background: var(--navy); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.08); transition: transform 0.15s, border-color 0.15s; }
  .member-card:hover { transform: translateY(-2px); border-color: var(--gold); }
  .member-avatar { font-size: 2.2rem; background: rgba(245,166,35,0.15); width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; border: 2px solid rgba(245,166,35,0.3); }
  .member-name  { font-weight: 800; font-size: 0.9rem; }
  .member-role  { font-size: 0.72rem; color: var(--gold); margin-top: 2px; }
  .member-tasks { font-size: 0.72rem; color: var(--gray); margin-top: 6px; }
  .member-del-btn { background: none; border: none; color: var(--gray); font-size: 0.7rem; cursor: pointer; margin-top: 6px; padding: 2px 8px; border-radius: 4px; transition: color 0.2s; }
  .member-del-btn:hover { color: var(--red); }

  .add-member-form { background: var(--navy); border-radius: 12px; padding: 16px; margin-top: 16px; border: 1px dashed rgba(255,255,255,0.15); }
  .add-member-form h3 { font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 2px; color: var(--gold); margin-bottom: 12px; }

  /* TOOLS */
  .tools-section { background: var(--navy); border-radius: 14px; padding: 20px; margin-bottom: 14px; border: 1px solid rgba(255,255,255,0.07); }
  .tools-section h3 { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; color: var(--gold); margin-bottom: 12px; }
  .tools-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(140px,1fr)); gap: 10px; }
  .tool-btn { background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.15); color: var(--white); padding: 14px 12px; border-radius: 10px; cursor: pointer; font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 0.82rem; text-align: center; transition: all 0.2s; }
  .tool-btn:hover { background: rgba(245,166,35,0.15); border-color: var(--gold); }
  .tool-btn-icon { font-size: 1.5rem; display: block; margin-bottom: 4px; }

  .belt-strip { height: 6px; background: linear-gradient(90deg,#000 0%,#000 30%,var(--red) 30%,var(--red) 70%,#000 70%); margin-bottom: 16px; border-radius: 3px; }

  /* EVENT LABELS */
  .tag-event {
    font-size: 0.65rem; font-weight: 800;
    padding: 2px 8px; border-radius: 20px;
    text-transform: uppercase; letter-spacing: 0.3px;
    color: white;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .event-dot {
    display: inline-block; width: 8px; height: 8px;
    border-radius: 50%; margin-right: 4px; flex-shrink: 0;
    box-shadow: 0 0 4px currentColor;
  }
  .events-manage { background: var(--navy); border-radius: 14px; padding: 16px; margin-bottom: 14px; border: 1px solid rgba(255,255,255,0.07); }
  .events-manage h3 { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; color: var(--gold); margin-bottom: 12px; }
  .event-chip {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 5px 12px; border-radius: 20px; margin: 4px;
    font-size: 0.78rem; font-weight: 700; color: white;
    cursor: pointer; transition: transform 0.15s, opacity 0.15s;
    text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  }
  .event-chip:hover { transform: scale(1.05); opacity: 0.9; }
  .event-chip-del { background: rgba(0,0,0,0.2); border: none; color: white; border-radius: 50%; width: 16px; height: 16px; cursor: pointer; font-size: 0.65rem; display: flex; align-items: center; justify-content: center; padding: 0; line-height: 1; }

  /* COLOR PICKER */
  .color-swatches { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 6px; }
  .swatch {
    width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
    border: 3px solid transparent; transition: transform 0.15s, border-color 0.15s;
  }
  .swatch:hover { transform: scale(1.15); }
  .swatch.selected { border-color: white; transform: scale(1.15); }

  /* TOAST */
  .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--green); color: white; padding: 12px 24px; border-radius: 30px; font-weight: 700; font-size: 0.88rem; z-index: 9999; transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1); box-shadow: 0 6px 20px rgba(39,174,96,0.4); }
  .toast.show  { transform: translateX(-50%) translateY(0); }
  .toast.error { background: var(--red); box-shadow: 0 6px 20px rgba(230,51,41,0.4); }

  /* SYNC indicator */
  .sync-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }
  .sync-dot.on  { background: var(--green); box-shadow: 0 0 6px var(--green); animation: pulse 2s infinite; }
  .sync-dot.off { background: var(--gray); }
  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }

  @media print {
    #firebase-status, header .tabs, .filter-bar, .btn-add, .task-btn, .task-actions, .status-cycle { display: none !important; }
    body { background: white; color: black; }
  }
</style>
</head>
<body>

<!-- Firebase Status Bar -->
<div id="firebase-status" class="connecting">ğŸ”„ Connexion Firebase en cours...</div>

<header>
  <div class="header-logo">ğŸ¥‹</div>
  <h1>Tableau de Bord <span>Bureau</span></h1>
  <p class="subtitle" id="club-name-display">
    <span class="sync-dot off" id="sync-dot"></span>
    <span id="club-name-text">Club de Judo</span>
  </p>
  <div class="tabs">
    <div class="tab active" onclick="showSection('kanban')"><span class="tab-icon">ğŸ“‹</span>TÃ¢ches</div>
    <div class="tab" onclick="showSection('agenda')"><span class="tab-icon">ğŸ“…</span>Agenda</div>
    <div class="tab" onclick="showSection('membres')"><span class="tab-icon">ğŸ‘¥</span>Membres</div>
    <div class="tab" onclick="showSection('documents')"><span class="tab-icon">ğŸ“</span>Documents</div>
    <div class="tab" onclick="showSection('outils')"><span class="tab-icon">âš™ï¸</span>Outils</div>
  </div>
</header>

<main>
  <!-- KANBAN -->
  <div id="section-kanban" class="section active">
    <div class="belt-strip" style="margin-top:14px;"></div>
    <div class="stats-bar">
      <div class="stat-card"><div class="stat-number" id="stat-todo">0</div><div class="stat-label">Ã€ faire</div></div>
      <div class="stat-card"><div class="stat-number" id="stat-done">0</div><div class="stat-label">TerminÃ©es</div></div>
      <div class="stat-card"><div class="stat-number" id="stat-overdue" style="color:#e63329;">0</div><div class="stat-label">En retard</div></div>
    </div>
    <div class="urgency-banner" id="urgency-banner" style="display:none;">âš ï¸ <span id="urgency-text"></span></div>
    <div class="filter-bar">
      <select id="filter-member" onchange="renderAll()"><option value="">ğŸ‘¤ Tous</option></select>
      <select id="filter-event" onchange="renderAll()"><option value="">ğŸ·ï¸ Tous Ã©vÃ©nements</option></select>
      <button class="btn-add" onclick="openNewTask()">â• TÃ¢che</button>
    </div>
    <div class="kanban">
      <div class="kanban-col col-todo">
        <div class="col-header">ğŸ“‹ <span>Ã€ Faire</span><span class="col-count" id="cnt-todo">0</span></div>
        <div id="col-todo-tasks"></div>
        <div class="empty-state" id="empty-todo"><div class="empty-state-icon">âœ…</div>Rien Ã  faire !</div>
      </div>
      <div class="kanban-col col-doing">
        <div class="col-header">âš¡ <span>En Cours</span><span class="col-count" id="cnt-doing">0</span></div>
        <div id="col-doing-tasks"></div>
        <div class="empty-state" id="empty-doing"><div class="empty-state-icon">ğŸ¥‹</div>Lancez-vous !</div>
      </div>
      <div class="kanban-col col-done">
        <div class="col-header">âœ… <span>TerminÃ©</span><span class="col-count" id="cnt-done">0</span></div>
        <div id="col-done-tasks"></div>
        <div class="empty-state" id="empty-done"><div class="empty-state-icon">ğŸ¯</div>Allez, courage !</div>
      </div>
    </div>
  </div>

  <!-- AGENDA -->
  <div id="section-agenda" class="section">
    <div class="belt-strip" style="margin-top:14px;"></div>
    <div id="agenda-content"></div>
  </div>

  <!-- MEMBRES -->
  <div id="section-membres" class="section">
    <div class="belt-strip" style="margin-top:14px;"></div>
    <div class="members-grid" id="members-grid"></div>
    <div class="add-member-form">
      <h3>â• Ajouter un membre</h3>
      <div class="form-row">
        <div class="form-group">
          <label>PrÃ©nom Nom</label>
          <input type="text" id="new-member-name" placeholder="Jean Dupont" />
        </div>
        <div class="form-group">
          <label>RÃ´le</label>
          <select id="new-member-role">
            <option>PrÃ©sident</option><option>Vice-PrÃ©sident</option>
            <option>SecrÃ©taire</option><option>TrÃ©sorier</option>
            <option>Responsable CompÃ©titions</option><option>Responsable Communication</option>
            <option>EntraÃ®neur</option><option>BÃ©nÃ©vole</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label>Emoji avatar</label>
        <input type="text" id="new-member-emoji" placeholder="ğŸ¥‹" maxlength="2" value="ğŸ¥‹" />
      </div>
      <button class="btn-primary" onclick="addMember()" style="max-width:200px;">Ajouter</button>
    </div>
  </div>

  <!-- DOCUMENTS -->
  <div id="section-documents" class="section">
    <div class="belt-strip" style="margin-top:14px;"></div>

    <!-- Bouton Drive principal -->
    <a href="https://drive.google.com/drive/folders/1aFBuzx7CV6wumjyW1A2XDqTBmtjjt901" target="_blank" style="text-decoration:none;">
      <div style="background:linear-gradient(135deg,#1a73e8,#0d47a1);border-radius:16px;padding:24px 20px;margin-bottom:20px;display:flex;align-items:center;gap:16px;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;box-shadow:0 6px 24px rgba(26,115,232,0.35);" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform=''">
        <div style="font-size:3rem;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.3));">ğŸ“‚</div>
        <div style="flex:1;">
          <div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:2px;color:white;">Dossier Google Drive</div>
          <div style="font-size:0.8rem;color:rgba(255,255,255,0.75);margin-top:3px;">Cliquez pour ouvrir Â· Tous les documents du club</div>
        </div>
        <div style="font-size:1.5rem;opacity:0.8;">â†—</div>
      </div>
    </a>

    <!-- Liens rapides -->
    <div style="background:var(--navy);border-radius:14px;padding:16px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.07);">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--gold);">ğŸ”— Liens Rapides</div>
        <button class="btn-add" onclick="openDocModal()" style="font-size:0.78rem;padding:7px 14px;">â• Ajouter</button>
      </div>
      <div id="docs-list">
        <div class="empty-state" id="empty-docs">
          <div class="empty-state-icon">ğŸ“</div>
          Aucun lien ajoutÃ© â€” cliquez sur â• Ajouter
        </div>
      </div>
    </div>

    <!-- Info -->
    <div style="background:rgba(26,115,232,0.08);border:1px solid rgba(26,115,232,0.2);border-radius:12px;padding:14px 16px;font-size:0.8rem;color:#74b9e7;line-height:1.8;">
      ğŸ’¡ <strong style="color:white;">Astuce :</strong> Depuis Google Drive, faites <strong style="color:white;">clic droit â†’ "Obtenir le lien"</strong> sur n'importe quel document pour ajouter un raccourci direct ici.
    </div>
  </div>

  <!-- OUTILS -->
  <div id="section-outils" class="section">
    <div class="belt-strip" style="margin-top:14px;"></div>
    <div class="tools-section">
      <h3>ğŸ”¥ Statut Firebase</h3>
      <div id="firebase-detail" style="font-size:0.82rem;color:var(--gray);line-height:1.8;">Initialisation...</div>
    </div>
    <div class="tools-section">
      <h3>ğŸ·ï¸ GÃ©rer les Ã‰vÃ©nements</h3>
      <p style="font-size:0.78rem;color:var(--gray);margin-bottom:12px;">CrÃ©ez des Ã©tiquettes colorÃ©es pour vos tournois, compÃ©titions, fÃªtes... Elles apparaÃ®tront sur les tÃ¢ches.</p>
      <div id="events-chips" style="margin-bottom:14px;min-height:32px;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:flex-end;">
        <div class="form-group" style="flex:1;min-width:140px;margin:0;">
          <label>Nom de l'Ã©vÃ©nement</label>
          <input type="text" id="new-event-name" placeholder="Ex: Tournoi Saint-Galmier" />
        </div>
        <div class="form-group" style="margin:0;">
          <label>Couleur</label>
          <div class="color-swatches" id="color-swatches">
            <div class="swatch selected" style="background:#e63329;" data-color="#e63329" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#e67e22;" data-color="#e67e22" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#f5a623;" data-color="#f5a623" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#27ae60;" data-color="#27ae60" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#2980b9;" data-color="#2980b9" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#8e44ad;" data-color="#8e44ad" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#16a085;" data-color="#16a085" onclick="selectColor(this)"></div>
            <div class="swatch" style="background:#c0392b;" data-color="#c0392b" onclick="selectColor(this)"></div>
          </div>
        </div>
        <button class="btn-primary" onclick="addEvent()" style="max-width:120px;padding:10px;white-space:nowrap;">â• CrÃ©er</button>
      </div>
    </div>
      <div class="form-row">
        <div class="form-group"><input type="text" id="club-name-input" placeholder="Mon Club de Judo" /></div>
        <div><button class="btn-primary" onclick="saveClubName()">Sauvegarder</button></div>
      </div>
    </div>
    <div class="tools-section">
      <h3>ğŸ’¾ Sauvegarde locale</h3>
      <div class="tools-grid">
        <button class="tool-btn" onclick="exportData()"><span class="tool-btn-icon">â¬‡ï¸</span>Exporter JSON</button>
        <button class="tool-btn" onclick="document.getElementById('import-file').click()"><span class="tool-btn-icon">â¬†ï¸</span>Importer JSON</button>
        <button class="tool-btn" onclick="window.print()"><span class="tool-btn-icon">ğŸ–¨ï¸</span>Imprimer/PDF</button>
        <button class="tool-btn" onclick="clearDone()" style="border-color:rgba(231,76,60,0.3);color:#e74c3c;"><span class="tool-btn-icon">ğŸ—‘ï¸</span>Archiver faites</button>
      </div>
      <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importData(event)" />
    </div>
    <div class="tools-section">
      <h3>ğŸ“– Guide d'utilisation</h3>
      <div style="font-size:0.82rem;color:#aaa;line-height:1.8;">
        <p>1ï¸âƒ£ <strong style="color:var(--white);">Membres</strong> â†’ Ajoutez les membres du bureau</p>
        <p>2ï¸âƒ£ <strong style="color:var(--white);">â• TÃ¢che</strong> â†’ CrÃ©ez et assignez des tÃ¢ches</p>
        <p>3ï¸âƒ£ <strong style="color:var(--white);">Statuts</strong> â†’ Tapez les boutons Ã€ faire / En cours / TerminÃ© directement sur la carte</p>
        <p>4ï¸âƒ£ <strong style="color:var(--white);">Synchro automatique</strong> â†’ Toutes les modifications sont visibles en temps rÃ©el par tout le bureau ğŸ”¥</p>
      </div>
    </div>
  </div>
</main>
<div class="modal-overlay" id="doc-modal">
  <div class="modal">
    <h2>ğŸ“ <span id="doc-modal-title">Nouveau Lien</span></h2>
    <div class="form-group">
      <label>Nom du document *</label>
      <input type="text" id="doc-name" placeholder="Ex: RÃ¨glement intÃ©rieur, Calendrier 2025..." />
    </div>
    <div class="form-group">
      <label>URL du document *</label>
      <input type="url" id="doc-url" placeholder="https://drive.google.com/..." />
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>CatÃ©gorie</label>
        <select id="doc-category">
          <option value="ğŸ“„ Administratif">ğŸ“„ Administratif</option>
          <option value="ğŸ† CompÃ©tition">ğŸ† CompÃ©tition</option>
          <option value="ğŸ’° Finance">ğŸ’° Finance</option>
          <option value="ğŸ“¢ Communication">ğŸ“¢ Communication</option>
          <option value="ğŸ“š Formation">ğŸ“š Formation</option>
          <option value="ğŸ”¹ Autre">ğŸ”¹ Autre</option>
        </select>
      </div>
      <div class="form-group">
        <label>IcÃ´ne</label>
        <select id="doc-icon">
          <option value="ğŸ“„">ğŸ“„ Document</option>
          <option value="ğŸ“Š">ğŸ“Š Tableau</option>
          <option value="ğŸ“‹">ğŸ“‹ Formulaire</option>
          <option value="ğŸ–¼ï¸">ğŸ–¼ï¸ Image</option>
          <option value="ğŸ“‘">ğŸ“‘ PDF</option>
          <option value="ğŸ”—">ğŸ”— Lien</option>
          <option value="ğŸ“…">ğŸ“… Calendrier</option>
          <option value="ğŸ’°">ğŸ’° Finance</option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeDocModal()">Annuler</button>
      <button class="btn-danger" id="doc-delete-btn" onclick="deleteDoc()" style="display:none;">ğŸ—‘ï¸</button>
      <button class="btn-primary" onclick="saveDoc()">ğŸ’¾ Enregistrer</button>
    </div>
  </div>
</div>

<!-- MODAL TÃ‚CHE -->
<div class="modal-overlay" id="task-modal">
  <div class="modal">
    <h2>ğŸ¥‹ <span id="modal-title-text">Nouvelle TÃ¢che</span></h2>
    <div class="form-group"><label>Titre *</label><input type="text" id="task-title" placeholder="Ex: Inscrire les judokas au tournoi..." /></div>
    <div class="form-group"><label>Description</label><textarea id="task-desc" placeholder="Informations complÃ©mentaires..."></textarea></div>
    <div class="form-group">
        <label>AssignÃ© Ã </label>
        <select id="task-member"><option value="">â€” Personne â€”</option></select>
      </div>
    <div class="form-row">
      <div class="form-group">
        <label>PrioritÃ©</label>
        <select id="task-priority"><option value="normale">Normale</option><option value="haute">ğŸ”´ Haute</option><option value="basse">ğŸŸ¢ Basse</option></select>
      </div>
      <div class="form-group"><label>Deadline</label><input type="date" id="task-deadline" /></div>
    </div>
    <div class="form-group">
      <label>Statut</label>
      <select id="task-status"><option value="todo">ğŸ“‹ Ã€ Faire</option><option value="doing">âš¡ En Cours</option><option value="done">âœ… TerminÃ©</option></select>
    </div>
    <div class="form-group">
      <label>ğŸ·ï¸ Ã‰vÃ©nement liÃ©</label>
      <select id="task-event"><option value="">â€” Aucun â€”</option></select>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal()">Annuler</button>
      <button class="btn-danger" id="modal-delete-btn" onclick="deleteTask()" style="display:none;">ğŸ—‘ï¸</button>
      <button class="btn-primary" onclick="saveTask()">ğŸ’¾ Enregistrer</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ========== FIREBASE SDK ========== -->
<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
import {
  getFirestore, collection, doc, onSnapshot,
  setDoc, deleteDoc, getDocs
} from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';

// â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
  apiKey: "AIzaSyA5Hi_kXIDj6VJjdsDD_tXTCsHX_wfSyDs",
  authDomain: "judo-club-85c55.firebaseapp.com",
  projectId: "judo-club-85c55",
  storageBucket: "judo-club-85c55.firebasestorage.app",
  messagingSenderId: "981958072439",
  appId: "1:981958072439:web:f287415902ed28a6708e72"
};

const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let tasks   = [];
let members = [];
let clubName = 'Club de Judo';
let editingId = null;
let fbReady = false;

const CATS = { Competition:'ğŸ†', Administratif:'ğŸ“„', Communication:'ğŸ“¢', Formation:'ğŸ“š', Logistique:'ğŸ“¦', Finance:'ğŸ’°', Autre:'ğŸ”¹' };

// â”€â”€ FIREBASE STATUS UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setStatus(state, msg) {
  const el = document.getElementById('firebase-status');
  el.className = state;
  el.textContent = msg;
  const dot = document.getElementById('sync-dot');
  dot.className = 'sync-dot ' + (state === 'connected' ? 'on' : 'off');

  const detail = document.getElementById('firebase-detail');
  if (state === 'connected') {
    detail.innerHTML = `âœ… <strong style="color:var(--green)">ConnectÃ© Ã  Firebase</strong><br>
    Projet : <code>judo-club-85c55</code><br>
    ğŸ”„ Synchronisation en temps rÃ©el active â€” toute modification est immÃ©diatement visible par tous les membres.`;
  } else if (state === 'error') {
    detail.innerHTML = `âŒ <strong style="color:var(--red)">Erreur de connexion</strong><br>${msg}<br><br>
    ğŸ‘‰ VÃ©rifiez que les <strong>rÃ¨gles Firestore</strong> autorisent la lecture/Ã©criture.<br>
    Allez dans Firebase Console â†’ Firestore â†’ RÃ¨gles â†’ copiez les rÃ¨gles ci-dessous :<br><br>
    <code style="background:rgba(0,0,0,0.3);padding:8px;border-radius:6px;display:block;font-size:0.75rem;margin-top:6px;">
    rules_version = '2';<br>
    service cloud.firestore {<br>
    &nbsp;&nbsp;match /databases/{database}/documents {<br>
    &nbsp;&nbsp;&nbsp;&nbsp;match /{document=**} {<br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;allow read, write: if true;<br>
    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
    &nbsp;&nbsp;}<br>
    }
    </code>`;
  } else {
    detail.innerHTML = `ğŸ”„ Connexion en cours...`;
  }
}

// â”€â”€ FIRESTORE LISTENERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startListeners() {
  // Tasks
  onSnapshot(collection(db, 'tasks'), snap => {
    tasks = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderAll();
  }, err => {
    setStatus('error', err.message);
  });

  // Members
  onSnapshot(collection(db, 'members'), snap => {
    members = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    renderMembers();
    renderAll();
  }, err => {
    setStatus('error', err.message);
  });

  // Club name
  onSnapshot(doc(db, 'config', 'club'), snap => {
    if (snap.exists()) {
      clubName = snap.data().name || 'Club de Judo';
      document.getElementById('club-name-text').textContent = clubName;
      document.getElementById('club-name-input').value = clubName;
    }
  });

  setStatus('connected', 'ğŸ”¥ SynchronisÃ© en temps rÃ©el');
  fbReady = true;
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
try {
  startListeners();
} catch(e) {
  setStatus('error', e.message);
}

// â”€â”€ WRITE HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fbSetTask(task) {
  await setDoc(doc(db, 'tasks', task.id), task);
}
async function fbDeleteTask(id) {
  await deleteDoc(doc(db, 'tasks', id));
}
async function fbSetMember(member) {
  await setDoc(doc(db, 'members', member.id), member);
}
async function fbDeleteMember(id) {
  await deleteDoc(doc(db, 'members', id));
}
async function fbSetConfig(key, value) {
  await setDoc(doc(db, 'config', key), value);
}

function genId() { return Date.now().toString(36) + Math.random().toString(36).substr(2,5); }

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  const fMember = document.getElementById('filter-member').value;
  const fEvent  = document.getElementById('filter-event').value;
  const today   = new Date(); today.setHours(0,0,0,0);

  let filtered = tasks.filter(t => {
    if (fMember && t.member !== fMember) return false;
    if (fEvent  && t.eventId !== fEvent) return false;
    return true;
  });

  renderCol('todo',  filtered.filter(t => t.status === 'todo'),  today);
  renderCol('doing', filtered.filter(t => t.status === 'doing'), today);
  renderCol('done',  filtered.filter(t => t.status === 'done'),  today);

  document.getElementById('stat-todo').textContent  = tasks.filter(t => t.status === 'todo').length;
  document.getElementById('stat-doing').textContent = tasks.filter(t => t.status === 'doing').length;
  document.getElementById('stat-done').textContent  = tasks.filter(t => t.status === 'done').length;
  const overdue = tasks.filter(t => t.deadline && t.status !== 'done' && new Date(t.deadline) < today).length;
  document.getElementById('stat-overdue').textContent = overdue;

  document.getElementById('cnt-todo').textContent  = filtered.filter(t => t.status === 'todo').length;
  document.getElementById('cnt-doing').textContent = filtered.filter(t => t.status === 'doing').length;
  document.getElementById('cnt-done').textContent  = filtered.filter(t => t.status === 'done').length;

  const urgent = tasks.filter(t => t.status !== 'done' && t.deadline && isDeadlineSoon(t.deadline, today));
  const banner = document.getElementById('urgency-banner');
  if (urgent.length > 0 && !fMember && !fCat) {
    banner.style.display = 'flex';
    document.getElementById('urgency-text').innerHTML = `<strong>${urgent.length} tÃ¢che(s)</strong> avec une deadline dans les 3 prochains jours !`;
  } else {
    banner.style.display = 'none';
  }

  // Update member filter
  const sel = document.getElementById('filter-member');
  const cur = sel.value;
  sel.innerHTML = '<option value="">ğŸ‘¤ Tous</option>';
  members.forEach(m => {
    const o = document.createElement('option');
    o.value = m.name; o.textContent = m.emoji + ' ' + m.name;
    sel.appendChild(o);
  });
  sel.value = cur;
}

function isDeadlineSoon(d, today) {
  const dl = new Date(d), diff = (dl - today) / 86400000;
  return diff >= 0 && diff <= 3;
}

function renderCol(status, ts, today) {
  const container = document.getElementById('col-' + status + '-tasks');
  const empty     = document.getElementById('empty-' + status);
  container.innerHTML = '';

  ts.sort((a,b) => {
    const p = { haute:0, normale:1, basse:2 };
    if (p[a.priority] !== p[b.priority]) return p[a.priority] - p[b.priority];
    if (a.deadline && b.deadline) return new Date(a.deadline) - new Date(b.deadline);
    if (a.deadline) return -1; if (b.deadline) return 1; return 0;
  });

  if (ts.length === 0) { empty.style.display = 'block'; return; }
  empty.style.display = 'none';

  ts.forEach(task => {
    const isOverdue = task.deadline && new Date(task.deadline) < today && task.status !== 'done';
    const isSoon    = task.deadline && isDeadlineSoon(task.deadline, today) && !isOverdue;
    const member    = members.find(m => m.name === task.member);
    const event     = events.find(e => e.id === task.eventId);
    let deadlineStr = '';
    if (task.deadline) {
      const dl = new Date(task.deadline);
      deadlineStr = dl.toLocaleDateString('fr-FR', { day:'2-digit', month:'short' });
    }
    const card = document.createElement('div');
    card.className = `task-card prio-${task.priority||'normale'} ${isOverdue?'overdue':''}`;
    card.innerHTML = `
      <div class="task-actions">
        <button class="task-btn" onclick="window._editTask('${task.id}')" title="Modifier">âœï¸</button>
      </div>
      ${event ? `<div style="margin-bottom:6px;"><span class="tag-event" style="background:${event.color};"><span class="event-dot" style="background:rgba(255,255,255,0.5);"></span>${event.name}</span></div>` : ''}
      <div class="task-title">${task.title}</div>
      ${task.desc ? `<div class="task-desc">${task.desc}</div>` : ''}
      <div class="task-meta">
        ${member ? `<span class="tag tag-member">${member.emoji} ${member.name}</span>` : ''}
        ${task.deadline ? `<span class="tag tag-deadline">ğŸ“… ${deadlineStr}</span>` : ''}
        <span class="tag tag-prio-${task.priority||'normale'}">${task.priority==='haute'?'ğŸ”´ Urgent':task.priority==='basse'?'ğŸŸ¢ Faible':'ğŸ”µ Normal'}</span>
        ${isOverdue ? '<span class="overdue-badge">âš ï¸ En retard</span>' : ''}
        ${isSoon    ? '<span class="overdue-badge" style="background:#e67e22;">â° BientÃ´t</span>' : ''}
      </div>
      <div class="status-cycle">
        <button class="status-btn todo-btn ${task.status==='todo'?'active':''}"  onclick="window._setStatus('${task.id}','todo')">Ã€ faire</button>
        <button class="status-btn doing-btn ${task.status==='doing'?'active':''}" onclick="window._setStatus('${task.id}','doing')">En cours</button>
        <button class="status-btn done-btn ${task.status==='done'?'active':''}"  onclick="window._setStatus('${task.id}','done')">TerminÃ©</button>
      </div>`;
    container.appendChild(card);
  });
}

// â”€â”€ MEMBERS RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMembers() {
  const grid = document.getElementById('members-grid');
  grid.innerHTML = '';
  members.forEach(m => {
    const mt = tasks.filter(t => t.member === m.name);
    const dn = mt.filter(t => t.status === 'done').length;
    const card = document.createElement('div');
    card.className = 'member-card';
    card.innerHTML = `
      <div class="member-avatar">${m.emoji}</div>
      <div class="member-name">${m.name}</div>
      <div class="member-role">${m.role}</div>
      <div class="member-tasks">ğŸ“‹ ${mt.length} tÃ¢che(s) Â· âœ… ${dn} faite(s)</div>
      <button class="member-del-btn" onclick="window._deleteMember('${m.id}')">ğŸ—‘ï¸ Retirer</button>`;
    grid.appendChild(card);
  });
}

// â”€â”€ GLOBAL HANDLERS (for inline onclick) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window._setStatus = async (id, status) => {
  const task = tasks.find(t => t.id === id);
  if (!task) return;
  await fbSetTask({ ...task, status, updatedAt: Date.now() });
  showToast('âœ… Statut mis Ã  jour !');
};

window._editTask = (id) => {
  const task = tasks.find(t => t.id === id);
  if (!task) return;
  editingId = id;
  document.getElementById('modal-title-text').textContent = 'Modifier la TÃ¢che';
  document.getElementById('task-title').value    = task.title;
  document.getElementById('task-desc').value     = task.desc || '';
  document.getElementById('task-deadline').value = task.deadline || '';
  document.getElementById('task-priority').value = task.priority || 'normale';
  document.getElementById('task-status').value   = task.status;
  document.getElementById('modal-delete-btn').style.display = 'inline-block';
  populateMemberSelect(task.member);
  renderEventSelects();
  document.getElementById('task-event').value = task.eventId || '';
  document.getElementById('task-modal').classList.add('open');
};

window._deleteMember = async (id) => {
  if (!confirm('Retirer ce membre ?')) return;
  await fbDeleteMember(id);
  showToast('ğŸ—‘ï¸ Membre retirÃ©');
};

// â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function populateMemberSelect(val) {
  const sel = document.getElementById('task-member');
  sel.innerHTML = '<option value="">â€” Personne â€”</option>';
  members.forEach(m => {
    const o = document.createElement('option');
    o.value = m.name; o.textContent = m.emoji + ' ' + m.name;
    if (val === m.name) o.selected = true;
    sel.appendChild(o);
  });
}

window.openNewTask = () => {
  editingId = null;
  document.getElementById('modal-title-text').textContent = 'Nouvelle TÃ¢che';
  document.getElementById('task-title').value    = '';
  document.getElementById('task-desc').value     = '';
  document.getElementById('task-deadline').value = '';
  document.getElementById('task-priority').value = 'normale';
  document.getElementById('task-status').value   = 'todo';
  document.getElementById('task-event').value    = '';
  document.getElementById('modal-delete-btn').style.display = 'none';
  populateMemberSelect('');
  renderEventSelects();
  document.getElementById('task-modal').classList.add('open');
  setTimeout(() => document.getElementById('task-title').focus(), 100);
};

window.closeModal = () => document.getElementById('task-modal').classList.remove('open');

window.saveTask = async () => {
  const title = document.getElementById('task-title').value.trim();
  if (!title) { showToast('âš ï¸ Titre obligatoire', true); return; }
  const task = {
    id:       editingId || genId(),
    title,
    desc:     document.getElementById('task-desc').value.trim(),
    member:   document.getElementById('task-member').value,
    priority: document.getElementById('task-priority').value,
    deadline: document.getElementById('task-deadline').value,
    status:   document.getElementById('task-status').value,
    eventId:  document.getElementById('task-event').value || '',
    updatedAt: Date.now(),
    createdAt: editingId ? (tasks.find(t=>t.id===editingId)?.createdAt||Date.now()) : Date.now()
  };
  await fbSetTask(task);
  showToast(editingId ? 'âœ… TÃ¢che modifiÃ©e !' : 'âœ… TÃ¢che ajoutÃ©e !');
  window.closeModal();
};

window.deleteTask = async () => {
  if (!editingId) return;
  if (!confirm('Supprimer cette tÃ¢che ?')) return;
  await fbDeleteTask(editingId);
  showToast('ğŸ—‘ï¸ TÃ¢che supprimÃ©e');
  window.closeModal();
};

window.addMember = async () => {
  const name  = document.getElementById('new-member-name').value.trim();
  const role  = document.getElementById('new-member-role').value;
  const emoji = document.getElementById('new-member-emoji').value.trim() || 'ğŸ¥‹';
  if (!name) { showToast('âš ï¸ Nom requis', true); return; }
  const m = { id: genId(), name, role, emoji };
  await fbSetMember(m);
  document.getElementById('new-member-name').value = '';
  showToast('ğŸ‘¥ Membre ajoutÃ© !');
};

window.saveClubName = async () => {
  clubName = document.getElementById('club-name-input').value.trim() || 'Club de Judo';
  await fbSetConfig('club', { name: clubName });
  showToast('âœ… Nom du club sauvegardÃ© !');
};

window.clearDone = async () => {
  const done = tasks.filter(t => t.status === 'done');
  if (done.length === 0) { showToast('Aucune tÃ¢che terminÃ©e', true); return; }
  if (!confirm(`Supprimer ${done.length} tÃ¢che(s) terminÃ©e(s) ?`)) return;
  for (const t of done) await fbDeleteTask(t.id);
  showToast(`ğŸ—‘ï¸ ${done.length} tÃ¢che(s) archivÃ©e(s)`);
};

window.exportData = () => {
  const data = { version: 2, clubName, tasks, members, exportedAt: new Date().toISOString() };
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `judo-taches-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  showToast('â¬‡ï¸ Fichier exportÃ© !');
};

window.importData = async (event) => {
  const file = event.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = async e => {
    try {
      const data = JSON.parse(e.target.result);
      if (!data.tasks || !data.members) throw new Error();
      if (!confirm(`Importer ${data.tasks.length} tÃ¢ches et ${data.members.length} membres ?`)) return;
      for (const t of data.tasks)   await fbSetTask(t);
      for (const m of data.members) await fbSetMember(m);
      if (data.clubName) await fbSetConfig('club', { name: data.clubName });
      showToast('âœ… Import rÃ©ussi !');
    } catch { showToast('âŒ Fichier invalide', true); }
  };
  reader.readAsText(file);
  event.target.value = '';
};

// â”€â”€ EVENTS (Ã©tiquettes) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let events = [];
let selectedColor = '#e63329';

onSnapshot(collection(db, 'events'), snap => {
  events = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderEventChips();
  renderEventSelects();
  renderAll();
}, err => console.warn('events listener:', err));

function renderEventChips() {
  const container = document.getElementById('events-chips');
  if (!container) return;
  if (events.length === 0) {
    container.innerHTML = `<span style="font-size:0.78rem;color:var(--gray);">Aucun Ã©vÃ©nement crÃ©Ã© pour l'instant</span>`;
    return;
  }
  container.innerHTML = events.map(e => `
    <span class="event-chip" style="background:${e.color};">
      ${e.name}
      <button class="event-chip-del" onclick="deleteEvent('${e.id}')" title="Supprimer">âœ•</button>
    </span>`).join('');
}

function renderEventSelects() {
  // Filter select
  const fsel = document.getElementById('filter-event');
  if (!fsel) return;
  const fcur = fsel.value;
  fsel.innerHTML = '<option value="">ğŸ·ï¸ Tous Ã©vÃ©nements</option>';
  events.forEach(e => {
    const o = document.createElement('option');
    o.value = e.id; o.textContent = 'ğŸ·ï¸ ' + e.name;
    fsel.appendChild(o);
  });
  fsel.value = fcur;

  // Task modal select
  const tsel = document.getElementById('task-event');
  if (!tsel) return;
  const tcur = tsel.value;
  tsel.innerHTML = '<option value="">â€” Aucun â€”</option>';
  events.forEach(e => {
    const o = document.createElement('option');
    o.value = e.id;
    o.textContent = 'ğŸ·ï¸ ' + e.name;
    o.style.background = '#1e2a4a';
    tsel.appendChild(o);
  });
  tsel.value = tcur;
}

window.selectColor = (el) => {
  document.querySelectorAll('.swatch').forEach(s => s.classList.remove('selected'));
  el.classList.add('selected');
  selectedColor = el.dataset.color;
};

window.addEvent = async () => {
  const name = document.getElementById('new-event-name').value.trim();
  if (!name) { showToast('âš ï¸ Nom requis', true); return; }
  const e = { id: genId(), name, color: selectedColor };
  await setDoc(doc(db, 'events', e.id), e);
  document.getElementById('new-event-name').value = '';
  showToast('ğŸ·ï¸ Ã‰vÃ©nement crÃ©Ã© !');
};

window.deleteEvent = async (id) => {
  if (!confirm('Supprimer cet Ã©vÃ©nement ? Les tÃ¢ches liÃ©es perdront leur Ã©tiquette.')) return;
  await deleteDoc(doc(db, 'events', id));
  showToast('ğŸ—‘ï¸ Ã‰vÃ©nement supprimÃ©');
};

// â”€â”€ DOCUMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let docs = [];
let editingDocId = null;

onSnapshot(collection(db, 'documents'), snap => {
  docs = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderDocs();
}, err => console.warn('docs listener:', err));

function renderDocs() {
  const list = document.getElementById('docs-list');
  const empty = document.getElementById('empty-docs');
  if (!list) return;

  const cards = docs.sort((a,b) => (a.category||'').localeCompare(b.category||''));

  // Group by category
  const groups = {};
  cards.forEach(d => {
    const cat = d.category || 'ğŸ”¹ Autre';
    if (!groups[cat]) groups[cat] = [];
    groups[cat].push(d);
  });

  if (docs.length === 0) {
    list.innerHTML = '';
    empty.style.display = 'block';
    return;
  }
  empty.style.display = 'none';

  let html = '';
  Object.entries(groups).forEach(([cat, items]) => {
    html += `<div style="margin-bottom:14px;">
      <div style="font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--gray);margin-bottom:8px;padding:0 4px;">${cat}</div>`;
    items.forEach(d => {
      html += `
      <div style="background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:12px 14px;margin-bottom:6px;display:flex;align-items:center;gap:12px;transition:background 0.15s;" onmouseover="this.style.background='rgba(255,255,255,0.09)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
        <div style="font-size:1.8rem;">${d.icon||'ğŸ“„'}</div>
        <div style="flex:1;min-width:0;">
          <div style="font-weight:800;font-size:0.88rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${d.name}</div>
          <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${d.url}</div>
        </div>
        <div style="display:flex;gap:6px;flex-shrink:0;">
          <a href="${d.url}" target="_blank" style="background:rgba(26,115,232,0.2);border:1px solid rgba(26,115,232,0.3);color:#74b9e7;padding:6px 12px;border-radius:8px;font-size:0.75rem;font-weight:700;text-decoration:none;white-space:nowrap;">â†— Ouvrir</a>
          <button onclick="openDocModal('${d.id}')" style="background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.15);color:var(--gray);padding:6px 10px;border-radius:8px;font-size:0.8rem;cursor:pointer;">âœï¸</button>
        </div>
      </div>`;
    });
    html += '</div>';
  });
  list.innerHTML = html;
}

window.openDocModal = (id = null) => {
  editingDocId = id;
  if (id) {
    const d = docs.find(x => x.id === id);
    if (!d) return;
    document.getElementById('doc-modal-title').textContent = 'Modifier le Lien';
    document.getElementById('doc-name').value = d.name;
    document.getElementById('doc-url').value = d.url;
    document.getElementById('doc-category').value = d.category || 'ğŸ“„ Administratif';
    document.getElementById('doc-icon').value = d.icon || 'ğŸ“„';
    document.getElementById('doc-delete-btn').style.display = 'inline-block';
  } else {
    document.getElementById('doc-modal-title').textContent = 'Nouveau Lien';
    document.getElementById('doc-name').value = '';
    document.getElementById('doc-url').value = '';
    document.getElementById('doc-category').value = 'ğŸ“„ Administratif';
    document.getElementById('doc-icon').value = 'ğŸ“„';
    document.getElementById('doc-delete-btn').style.display = 'none';
  }
  document.getElementById('doc-modal').classList.add('open');
  setTimeout(() => document.getElementById('doc-name').focus(), 100);
};

window.closeDocModal = () => document.getElementById('doc-modal').classList.remove('open');

window.saveDoc = async () => {
  const name = document.getElementById('doc-name').value.trim();
  const url  = document.getElementById('doc-url').value.trim();
  if (!name) { showToast('âš ï¸ Nom obligatoire', true); return; }
  if (!url)  { showToast('âš ï¸ URL obligatoire', true); return; }
  const d = {
    id: editingDocId || genId(),
    name,
    url,
    category: document.getElementById('doc-category').value,
    icon: document.getElementById('doc-icon').value,
    updatedAt: Date.now()
  };
  await setDoc(doc(db, 'documents', d.id), d);
  showToast(editingDocId ? 'âœ… Lien modifiÃ© !' : 'âœ… Lien ajoutÃ© !');
  window.closeDocModal();
};

window.deleteDoc = async () => {
  if (!editingDocId) return;
  if (!confirm('Supprimer ce lien ?')) return;
  await deleteDoc(doc(db, 'documents', editingDocId));
  showToast('ğŸ—‘ï¸ Lien supprimÃ©');
  window.closeDocModal();
};

document.getElementById('doc-modal').addEventListener('click', e => { if (e.target.id === 'doc-modal') window.closeDocModal(); });

// â”€â”€ SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.showSection = (name) => {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.getElementById('section-' + name).classList.add('active');
  const names = ['kanban','agenda','membres','documents','outils'];
  document.querySelectorAll('.tab').forEach((t,i) => { if (names[i]===name) t.classList.add('active'); });
  if (name === 'agenda')  renderAgenda();
  if (name === 'membres') renderMembers();
  if (name === 'documents') renderDocs();
};

// â”€â”€ AGENDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAgenda() {
  const container = document.getElementById('agenda-content');
  const today = new Date(); today.setHours(0,0,0,0);
  const withDeadline = tasks.filter(t => t.deadline && t.status !== 'done').sort((a,b) => new Date(a.deadline)-new Date(b.deadline));
  if (withDeadline.length === 0) {
    container.innerHTML = `<div class="empty-state" style="padding:60px 20px;"><div class="empty-state-icon" style="opacity:1;font-size:3rem;">ğŸ“…</div><p style="font-size:1rem;color:var(--white);margin-top:12px;">Aucune deadline planifiÃ©e</p></div>`;
    return;
  }
  const groups = {};
  withDeadline.forEach(t => {
    const dl = new Date(t.deadline), diff = Math.ceil((dl-today)/86400000);
    let label = diff < 0 ? 'âš ï¸ En retard' : diff===0 ? "ğŸ“ Aujourd'hui" : diff<=3 ? 'ğŸ”´ Dans 3 jours' : diff<=7 ? 'ğŸŸ  Cette semaine' : diff<=14 ? 'ğŸŸ¡ Dans 2 semaines' : 'ğŸŸ¢ Plus tard';
    if (!groups[label]) groups[label] = [];
    groups[label].push(t);
  });
  let html = '';
  Object.entries(groups).forEach(([label, ts]) => {
    html += `<div style="margin-bottom:16px;"><div style="font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;color:var(--gold);padding:8px 12px;background:rgba(245,166,35,0.1);border-radius:8px;margin-bottom:8px;border-left:3px solid var(--gold);">${label}</div>`;
    ts.forEach(t => {
      const m = members.find(m => m.name === t.member);
      const dl = new Date(t.deadline);
      html += `<div style="background:var(--navy);border-radius:10px;padding:12px;margin-bottom:6px;border:1px solid rgba(255,255,255,0.07);display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="window._editTask('${t.id}');window.showSection('kanban')">
        <div style="font-size:1.5rem;">${CATS[t.category]||'ğŸ”¹'}</div>
        <div style="flex:1;"><div style="font-weight:800;font-size:0.88rem;">${t.title}</div>
        <div style="font-size:0.72rem;color:var(--gray);margin-top:2px;">${m?m.emoji+' '+m.name+' Â· ':''}ğŸ“… ${dl.toLocaleDateString('fr-FR',{weekday:'short',day:'numeric',month:'long'})}</div></div>
        <span style="font-size:0.65rem;font-weight:700;padding:4px 10px;border-radius:20px;background:${t.priority==='haute'?'rgba(231,76,60,0.2)':'rgba(41,128,185,0.2)'};color:${t.priority==='haute'?'#e74c3c':'#74b9e7'};">${t.priority==='haute'?'ğŸ”´ Urgent':'Normal'}</span>
      </div>`;
    });
    html += '</div>';
  });
  container.innerHTML = html;
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, error=false) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast' + (error?' error':'');
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 2800);
}
window.showToast = showToast;

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('task-modal').addEventListener('click', e => { if (e.target.id==='task-modal') window.closeModal(); });
document.addEventListener('keydown', e => { if (e.key==='Escape') window.closeModal(); });
</script>
</body>
</html>
